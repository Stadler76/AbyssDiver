
:: Generate AI Portrait [noreturn nobr]

<div class="portrait-generator-container">
	<div id="notification"></div>

	<h3>OpenAI Dalle Image Generator</h3>

	<<if settings.OpenAIAPIKey && (settings.OpenAIAPIKey.startsWith("sk") || $userAPIKey.startsWith("sk"))>>
		<<set $characterDescription = setup.evaluateDalleCharacterDescription($mc)>>
		<<set settings.OpenAIAPIKey = $userAPIKey>>

		<div class="portrait-api-notice">
			Generate a new AI portrait of your character (this will take at least a few seconds). Be aware that you must pay with credit on your OpenAI account for each generation.
		</div>

		<<button "Generate">>
			<<script>>
				(async () => {
					await setup.openAI_GenerateDallePortrait();
					await setup.displayImage();
				})();
			<</script>>
			<<set setup.firstPortraitGen = true>>
		<</button>>
		<button class="dark-btn obsidian" data-passage="Portrait Prompt">View Dalle Portrait Prompt</button><br><br>

		<div class="portrait-image-container">
			<img class="dalleImage" src="" alt="AI Generated Portrait" style="max-width: 70%;">
		</div>
	<<else>>
		<div class="portrait-api-form">
			<address>Enter your OpenAI API key to enable the generation of AI character portraits.</address>
			<address>Do NOT share your save file if you have entered your API key!</address>
			<br>
			<button class="dark-btn obsidian" data-passage="API Key Guide">API Key Guide</button>
			<button class="dark-btn obsidian" data-passage="Dalle Portrait Prompt">View Dalle Portrait Prompt</button>
			<br><br>
			Enter your OpenAI API key:
			<br>
			<<textbox "$userAPIKey" "">>
			<br>
			<<button "Submit">>
				<<set settings.OpenAIAPIKey to $userAPIKey>>
				<<goto "Generate AI Portrait">>
			<</button>>
		</div>
	<</if>>

	<hr>

	<h3>ComfyUI Local Image Generator</h3>
	<address>- Requires you to run the one-click-comfyui found in the AbyssDiver local-gen folder.</address>
	<address>- Double click the batch (.bat) file on Windows, or double click the bash (.sh) file for Linux.</address>
	<address>- Read the terminal for further instructions.</address>

	<br>

	<address>You will need a total of at least 17GBs available for ComfyUI and the models to be downloaded.</address>
	<address>It is recommended you have a graphics card with at least 4GBs of VRAM.</address>
	<address>It will still run even without a graphics card, but will be on the CPU.</address>

	<address id="comfyui-enabled">...</address>

	<<script>>
		(async () => {
			await setup.updateComfyUIStatus();
		})();
	<</script>>

	<br>
	<div class="portrait-image-container">
		<img class="dalleImage" src="" alt="AI Generated Portrait" style="max-width: 70%;">
	</div>

	<<button "Generate">>
		<<script>>
			(async () => {
				await setup.comfyUI_GeneratePortrait();
				await setup.displayImage();
			})();
		<</script>>
		<<set setup.firstPortraitGen = true>>
	<</button>>

	<button class="dark-btn obsidian" data-passage="ComfyUI Portrait Prompt">View ComfyUI Portrait Prompt</button>
	<br>

	<hr>

	Once your portrait is generated, you can save it for long term use, otherwise it will be permanently overridden when you generate a new portrait.
	<br><br>
	To save for long term usage, do the following:
	<ol>
	<li>Right click and save image</li>
	<li>Rename image to "CharacterPortraitOverride.png"</li>
	<li>Move image to the folder "/images/GeneratedPortraits" from AbyssDiver's root directory.</li>
	<li>Refresh the page or travel.</li>
	</ol>

	Custom Environmental Descriptors Prompt:
	<<textbox "$customPromptPrefix" "">>

	<br>

	Custom Character Details Prompt:
	<<textbox "$customPromptSuffix" "">>

	<br>

	<<button "Set Values">>
		<<set setup.customPromptPrefix = $customPromptPrefix>>
		<<set setup.customPromptSuffix = $customPromptSuffix>>
	<</button>>

	<hr>

	<div class="portrait-navigation">
		<button class="dark-btn obsidian" onclick="goBackToPassage(SugarCube.State.variables.menuReturn)">Confirm</button>
		<button class="dark-btn obsidian" onclick="SugarCube.Engine.backward()">Back</button>
	</div>

	<div class="portrait-navigation">
		<button class="dark-btn obsidian" onclick="SugarCube.Engine.backward()">Back</button>
	</div>
</div>

:: Dalle Portrait Prompt [noreturn nobr]

This prompt is made to be used with DALL-E 3 or ChatGPT and may require modification to be used with other image models, such as Stable Diffusion. It also has all NSFW information stripped away, so you can add that back in if you are using an uncensored model.<br><br>

If you have ChatGPT Plus, then you can paste this prompt directly into ChatGPT and it should work well.<br><br>

Prompt:<br><br>

Create an anime-inspired digital painting of a single adventurer with each of the following traits, in the background of the Abyss from MiA. Do NOT use the word character in the final prompt.<br><br>

<<= setup.evaluateDalleCharacterDescription(State.variables.mc) >><br><br>

<<button "Copy Prompt">>
	<<script>>
		var promptText = "Create an anime-inspired digital painting of a single adventurer with each of the following traits, in the background of the Abyss from MiA. Do NOT use the word character in the final prompt.\n\n" + setup.evaluateDalleCharacterDescription(State.variables.mc);
		navigator.clipboard.writeText(promptText).then(function() {
			alert("Prompt copied to clipboard!");
		}, function() {
			alert("Failed to copy prompt. Please try again.");
		});
	<</script>>
<</button>><br><br>

<button class="dark-btn obsidian" onclick="SugarCube.Engine.backward()">Back</button>

:: ComfyUI Portrait Prompt [noreturn nobr]

This prompt is made to be used with ComfyUI using the Pony Hassaku Hentai model.<br><br>

If you want to run prompts separately, make sure to have the correct model downloaded. The link can be found at the top of the local-gen's `installer.py` script.

Prompt:<br><br>

Create an anime-inspired digital painting of a single adventurer with each of the following traits, in the background of the Abyss from MiA. Do NOT use the word character in the final prompt.<br><br>

<<= setup.evaluateDalleCharacterDescription(State.variables.mc) >><br><br>

<<button "Copy Prompt">>
	<<script>>
		var promptText = "Create an anime-inspired digital painting of a single adventurer with each of the following traits, in the background of the Abyss from MiA. Do NOT use the word character in the final prompt.\n\n" + setup.evaluateDalleCharacterDescription(State.variables.mc);
		navigator.clipboard.writeText(promptText).then(function() {
			alert("Prompt copied to clipboard!");
		}, function() {
			alert("Failed to copy prompt. Please try again.");
		});
	<</script>>
<</button>><br><br>

<button class="dark-btn obsidian" onclick="SugarCube.Engine.backward()">Back</button>
